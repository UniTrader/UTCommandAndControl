<?xml version="1.0" encoding="UTF-8"?>
<aiscript name="ut.cac.com.drone.fight" version="30" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://utnas/~unitrader/XRebirthxsds/aiscripts.xsd">
<!--Just refering to Vanilla Code here for now.
-->


  <params>
    <param name="params" comment="script params as table - used directly here"/>
    <param name="freedrones" comment="Drone Managment Group of the DO - included ones are available for Orders, excluded ones not."/>
  </params>
  <init>
  </init>
  <interrupts>
    <!-- maybe exclude this one if close to Missile?? -->
    <handler ref="ut_cac_drone_recall_listener"/>
  </interrupts>
  <attention min="visible">
    <actions>
      <add_to_group groupname="$primarytargets" object="$params.$target"/>
      <do_if value="@$params.$othertargets == true">
        <find_gravidar_contact groupname="$secondarytargets" functional="true" multiple="true" object="this.ship" maybeattackedby="this.ship">
          <match_distance object="$params.$target" max="700m"/>
        </find_gravidar_contact>
      </do_if>
      <do_else>
        <set_value name="$secondarytargets" exact="null"/>
      </do_else>
      <leave_formation object="this.ship"/>
      <debug_text filter="general" text="'%1 %2 %3 Interceptor Drone %5 sent against: %6'.[player.age,this.name,this.container.name,this.ship.name,$params.$target]"/>
      <run_script name="'fight.attack.object.fighter'">
        <param name="primarytargets" value="$primarytargets" comment="Group of objects to destroy before moving on to other nearby targets" />
        <param name="secondarytargets" value="$secondarytargets" comment="Group of objects to destroy after primary targets, before moving on to other nearby targets" />
        <param name="pursuedistance" value="this.ship.commander.maxcombatrange.turrets" comment="Distance to pursue/escort (if pursuetargets true or 'escort' provided). Default: 50km" />
        <param name="pursuetargets" value="false" comment="Pursue the target no matter what. Default: false" />
        <param name="allowothertargets" value="false" comment="Whether the script shall keep running when all primary targets have been destroyed. Default: true" />
      </run_script>
    </actions>
  </attention>
  <on_abort>
    <!-- Script Terminated - set Drones into self-destruct mode and pass them as group via signal, so a replacement DO can recover them -->
  </on_abort>
</aiscript>
