<?xml version="1.0" encoding="UTF-8"?>
<aiscript xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" name="ut.cac.com.manager.findjob" xsi:noNamespaceSchemaLocation="http://utnas/~unitrader/XRebirthxsds/aiscripts.xsd" version="1">
  <params>
    <param name="params" default="false" comment="pass a single Table filled with the wanted param Values here to make calls via list possible (always has priority)"/>
    <param name="entity" default="false" comment="Entity who needs (Trade)Orders (NOT as Ship)"/>
  </params>
  <attention min="unknown">
    <actions>
      <do_if value="$params">
        <do_if value="$params.$entity?">
          <set_value name="$entity" exact="$params.$entity"/>
        </do_if>
      </do_if>
      <remove_value name="$params"/>
      <do_if value="not $entity.exists">
        <return/>
      </do_if>
      
      <set_command command="command.support" param="$entity.container"/>
      <do_if value="this.$ut_cac?">
        <set_value name="this.$ut_cac.$isactive"/>
      </do_if>
      
      <!-- first try: send Ship Trading or Mining -->
      <do_if value="$entity.ship.primarypurpose == objectpurpose.trade or $entity.ship.primarypurpose == objectpurpose.mine or $entity.ship.cargo.tags.count gt 1 or ( $entity.ship.cargo.tags.count == 1 and not  $entity.ship.cargo.tags.indexof.{tag.fuel} )" comment="Either defined as Trading Ship os has other Cargo Capacity than Fuel">
        <run_script name="'ut.cac.com.manager.findjob.trade'" result="$success" >
          <param name="entity" value="$entity"/>
        </run_script>
        <do_if value="$success">
          <return/>
        </do_if>
      </do_if>
      
      <!-- Second Try: send Ship Patrolling (currently only Station Zone) - can be Taken for Escorts there -->
      <do_if value="$entity.ship.primarypurpose == objectpurpose.fight or ( $entity.ship.dps.all * 75 gt ($entity.ship.maxshield + $entity.ship.maxhull ))" comment="Either defined as Fight Ship or could kill itself in under 75 seconds">
        <run_script name="'ut.cac.com.manager.findjob.fight'" result="$success" >
          <param name="entity" value="$entity"/>
        </run_script>
        <do_if value="$success">
          <return/>
        </do_if>
      </do_if>
      
      <!-- Third: Just let them Idle for now (default - no need to give a specific Command)  -->
      <signal_objects object="this" param="'new order'" param2="table[$script='ut.cac.microorder',$displayname={5554103,20005},$order='wait order',$time=30min,$interruptable=true]"/>
      
    </actions>
  </attention>
</aiscript>
