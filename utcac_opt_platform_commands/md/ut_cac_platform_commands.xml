<?xml version="1.0" encoding="UTF-8"?>
<mdscript xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" name="UT_Platform_Commands" xsi:noNamespaceSchemaLocation="http://utnas/~unitrader/XRebirthxsds/md.xsd">
  <cues>
      <cue name="Ship_Docked">
      <conditions>
        <event_object_changed_room object="player.entity"/>
        <check_value value="player.entity.container.isclass.ship and player.controlled != player.primaryship and player.entity.container.owner == faction.player"/>
      </conditions>
      <actions>
        <reset_cue cue="Player_Undocked"/>
        <!-- Gather Zones in current Sector ans Sectors in current Cluster for regular view check -->
        <find_zone groupname="$spaces" space="player.sector" multiple="true" known="true" tempzone="false" priorityzone="true"/>
        <find_sector groupname="$spaces" space="player.cluster" multiple="true" known="true"/>
        <create_group groupname="$objects"/>
        <set_value name="$tracked_objects" exact="table[]"/>
      </actions>
      <cues>
        <cue name="Update_spaces">
          <conditions>
            <event_object_changed_sector object="player.ship"/>
          </conditions>
          <actions>
            <clear_group group="$spaces"/>
            <find_zone groupname="$spaces" space="player.sector" multiple="true" known="true" tempzone="false" priorityzone="true"/>
            <find_sector groupname="$spaces" space="player.cluster" multiple="true" known="true"/>
          </actions>
        </cue>
        <cue name="Check_Player_Hover">
          <delay exact="100ms"/>
          <actions>
            <clear_group group="$objects"/>
            <!-- find new Objects every 5 loops -->
            <set_value name="$loop" operation="subtract"/>
            <do_if value="$loop le 0">
              <set_value name="$loop" exact="6"/>
              <find_object name="$objects" space="player.zone" multiple="true">
                <match_is_in_view_of object="player.entity" vertical="10deg" horizontal="10deg"/>
                <match_distance object="player.ship" max="player.ship.maxradarrange"/>
                <match class="class.station" negate="true"/>
                <match_size min="200m"/>
              </find_object>
              <find_station name="$stations" space="player.zone" multiple="true">
                <match_is_in_view_of object="player.entity" vertical="50deg" horizontal="50deg"/>
                <match_distance object="player.ship" max="player.ship.maxradarrange + 5km"/>
              </find_station>
              <do_all exact="$stations.count" counter="$i">
                <find_object_component groupname="$objects" object="$stations.{$i}" integrated="false" multiple="true">
                  <match_is_in_view_of object="player.entity" vertical="10deg" horizontal="10deg"/>
                  <match_distance object="player.ship" max="player.ship.maxradarrange"/>
                  <match_size min="500m"/>
                  <match_any>
                    <match class="class.production"/>
                    <match class="class.storage"/>
                    <match class="class.buildmodule"/>
                    <match class="class.dronelaunchpad"/>
                    <match class="class.radar"/>
                  </match_any>
                  <!--match_any negate="true">
                    <match class="class.production"/>
                  </match_any-->
                </find_object_component>
              </do_all>
              <do_all exact="$objects.count" counter="$i">
                <set_value name="$tracked_objects.{$objects.{$i}}" operation="add" exact="5"/>
              </do_all>
              <set_value name="$keys" exact="$tracked_objects.keys.list"/>
              <set_value name="$highest_focus_object" exact="null"/>
              <set_value name="$highest_focus_number" exact="null"/>
              <do_all exact="$keys.count" counter="$i" reverse="true">
                <set_value name="$tracked_objects.{$keys.{$i}}" operation="subtract" exact="2"/>
                <do_if value="$tracked_objects.{$keys.{$i}} le 0">
                  <remove_value name="$tracked_objects.{$keys.{$i}}"/>
                </do_if>
                <do_elseif value="$tracked_objects.{$keys.{$i}} gt $highest_focus_number">
                  <set_value name="$highest_focus_object" exact="$keys.{$i}"/>
                  <set_value name="$highest_focus_number" exact="$tracked_objects.{$keys.{$i}}"/>
                </do_elseif>
              </do_all>
            </do_if>
            <!-- else check already known Objects if their Value should be increased or decreased -->
            <do_else>
              <set_value name="$keys" exact="$tracked_objects.keys.list"/>
              <set_value name="$highest_focus_object" exact="null"/>
              <set_value name="$highest_focus_number" exact="null"/>
              <do_all exact="$keys.count" counter="$i" reverse="true">
                <!-- check if in Sight - if yes increase Value by 3, if no decrease by 2 -->
                <check_object object="$keys.{$i}" result="$result">
                  <match_is_in_view_of object="player.entity" vertical="10deg" horizontal="10deg"/>
                  <match_distance object="player.ship" max="player.ship.maxradarrange"/>
                </check_object>
                <do_if value="$result">
                  <set_value name="$tracked_objects.{$keys.{$i}}" operation="add" exact="3"/>
                </do_if>
                <do_else>
                  <set_value name="$tracked_objects.{$keys.{$i}}" operation="subtract" exact="2"/>
                </do_else>
                <do_if value="$tracked_objects.{$keys.{$i}} le 0">
                  <remove_value name="$tracked_objects.{$keys.{$i}}"/>
                </do_if>
                <do_elseif value="$tracked_objects.{$keys.{$i}} gt $highest_focus_number">
                  <set_value name="$highest_focus_object" exact="$keys.{$i}"/>
                  <set_value name="$highest_focus_number" exact="$tracked_objects.{$keys.{$i}}"/>
                </do_elseif>
              </do_all>
            
            </do_else>
            <do_if value="$highest_focus_number ge 40">
              <set_value name="$tracked_objects" exact="table[]"/>
              <reset_cue cue="this"/>
              <!-- start conversation -->
            </do_if>
            <do_else>
              <remove_help all="true"/>
              <do_if value="$highest_focus_number ge 37">
                <show_help custom="'\033M»»»»»»»»»»»»»»»»»»»»\033X %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms"/>
              </do_if>
              <do_elseif value="$highest_focus_number ge 36">
                <show_help custom="'\033M»»»»»»»»»»»»»»»»»»»\033R»\033X %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 35">
                <show_help custom="'\033M»»»»»»»»»»»»»»»»»»\033R»»\033X %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 34">
                <show_help custom="'\033M»»»»»»»»»»»»»»»»»\033R»»»\033X %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 33">
                <show_help custom="'\033M»»»»»»»»»»»»»»»»\033R»»»»\033X %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 32">
                <show_help custom="'\033M»»»»»»»»»»»»»»»\033R»»»»»\033X %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 31">
                <show_help custom="'\033M»»»»»»»»»»»»»»\033R»»»»»»\033X %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 30">
                <show_help custom="'\033M»»»»»»»»»»»»»\033R»»»»»»\033Y»\033X %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 29">
                <show_help custom="'\033M»»»»»»»»»»»»\033R»»»»»»\033Y»»\033X %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 28">
                <show_help custom="'\033M»»»»»»»»»»»\033R»»»»»»\033Y»»»\033X %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 27">
                <show_help custom="'\033M»»»»»»»»»»\033R»»»»»»\033Y»»»»\033X %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 26">
                <show_help custom="'\033M»»»»»»»»»\033R»»»»»»\033Y»»»»»\033X %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 25">
                <show_help custom="'\033M»»»»»»»»\033R»»»»»»\033Y»»»»»\033G»\033X %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms" silent="true"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 24">
                <show_help custom="'\033M»»»»»»»\033R»»»»»»\033Y»»»»»\033G»»\033X %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms" silent="true"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 23">
                <show_help custom="'\033M»»»»»»\033R»»»»»»\033Y»»»»»\033G»»»\033X %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms" silent="true"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 22">
                <show_help custom="'\033M»»»»»\033R»»»»»»\033Y»»»»»\033G»»»»\033X %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms" silent="true"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 21">
                <show_help custom="'\033M»»»»\033R»»»»»»\033Y»»»»»\033G»»»»»\033X %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms" silent="true"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 20">
                <show_help custom="'\033M»»»\033R»»»»»»\033Y»»»»»\033G»»»»»\033X» %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms" silent="true"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 19">
                <show_help custom="'\033M»»\033R»»»»»»\033Y»»»»»\033G»»»»»\033X»» %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms" silent="true"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 18">
                <show_help custom="'\033M»\033R»»»»»»\033Y»»»»»\033G»»»»»\033X»»» %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms" silent="true"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 17">
                <show_help custom="'\033R»»»»»»\033Y»»»»»\033G»»»»»\033X»»»» %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms" silent="true"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 16">
                <show_help custom="'\033R»»»»»\033Y»»»»»\033G»»»»»\033X»»»»» %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms" silent="true"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 15">
                <show_help custom="'\033R»»»»\033Y»»»»»\033G»»»»»\033X»»»»»» %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms" silent="true"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 14">
                <show_help custom="'\033R»»»\033Y»»»»»\033G»»»»»\033X»»»»»»» %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms" silent="true"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 13">
                <show_help custom="'\033R»»\033Y»»»»»\033G»»»»»\033X»»»»»»»» %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms" silent="true"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 12">
                <show_help custom="'\033R»\033Y»»»»»\033G»»»»»\033X»»»»»»»»» %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms" silent="true"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 11">
                <show_help custom="'\033Y»»»»»\033G»»»»»\033X»»»»»»»»»» %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms" silent="true"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 10">
                <show_help custom="'\033Y»»»»\033G»»»»»\033X»»»»»»»»»»» %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms" silent="true"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 9">
                <show_help custom="'\033Y»»»\033G»»»»»\033X»»»»»»»»»»»» %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms" silent="true"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 8">
                <show_help custom="'\033Y»»\033G»»»»»\033X»»»»»»»»»»»»» %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms" silent="true"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 7">
                <show_help custom="'\033Y»\033G»»»»»\033X»»»»»»»»»»»»»» %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms" silent="true"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 6">
                <show_help custom="'\033G»»»»»\033X»»»»»»»»»»»»»»» %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms" silent="true"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 5">
                <show_help custom="'\033G»»»»\033X»»»»»»»»»»»»»»»» %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms" silent="true"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 4">
                <show_help custom="'\033G»»»\033X»»»»»»»»»»»»»»»»» %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms" silent="true"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 3">
                <show_help custom="'\033G»»\033X»»»»»»»»»»»»»»»»»» %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms" silent="true"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 2">
                <show_help custom="'\033G»\033X»»»»»»»»»»»»»»»»»»» %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms" silent="true"/>
              </do_elseif>
              <do_elseif value="$highest_focus_number ge 1">
                <show_help custom="'»»»»»»»»»»»»»»»»»»»» %1\n%2'.[$tracked_objects.keys.count,$highest_focus_object.name]" duration="500ms"/>
              </do_elseif>
              <reset_cue cue="this"/>
            </do_else>
          </actions>
        </cue>
      </cues>
    </cue>
    <cue name="Player_Undocked" comment="Player Undocked: stop Platform Scripts and reset cue for player wait until docked again">
      <conditions>
        <event_object_changed_room object="player.entity"/>
        <check_value exact="player.entity.container" value="player.primaryship" comment="Only if player is on his ship"/>
      </conditions>
      <actions>
        <reset_cue cue="Ship_Docked"/>
      </actions>
    </cue>
  </cues>
</mdscript>
