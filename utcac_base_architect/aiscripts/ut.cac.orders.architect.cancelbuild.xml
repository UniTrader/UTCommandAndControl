<?xml version="1.0" encoding="UTF-8" ?>
<aiscript name="ut.cac.orders.architect.cancelbuild" priority="99" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://utnas/~unitrader/XRebirthxsds/aiscripts.xsd">
  <!--
    This Script is responsible to cancel all Builds which are based on the Cancelled to keep the Orderlist consistent.
    
    ToDo when its ready: add Functions needed for Branching Build Trees like the one planned for the HQ 
  -->
  <params>
    <param name="params" default="false" comment="pass a single Table filled with the wanted param Values here to make calls via list possible (always has priority)"/>
    <param name="order_pos" />
  </params>
  <actions>
    <debug_text filter="general" chance="@this.$debug * 100" text="'%1 %2 Canceling Sequence %3 from Order %4'.[player.age,this.name,$params.$sequence,$order_pos]"/>
    <do_all exact="this.$orderlist.count" counter="$i">
      <!-- Cancel each subsequent Order which   is a Build Order VVVVVVV  and has a Sequence to extend VVVVVVVV  and extends the same Sequence as the Build Order to be cancelled VVVVV -->
      <do_if value="this.$orderlist.{$i}.$script == 'ut.cac.com.architect.build' and this.$orderlist.{$i}.$sequence? and $params.$sequence == this.$orderlist.{$i}.$sequence">
        <remove_value name="this.$orderlist.{$i}"/>
        <debug_text filter="general" chance="@this.$debug * 100" text="'==> Canceled Order %1'.[$i]"/>
      </do_if>
      <do_if value="$order_pos == $i">
        <break/>
      </do_if>
    </do_all>
  </actions>
</aiscript>